*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.21" SourceFile="foxrefoptions.scx" CPID="1252" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="1" />

	*<PropValue>
		DataSource = .NULL.
		Height = 0
		Left = 0
		Name = "Dataenvironment"
		Top = 0
		Width = 0
	*</PropValue>

ENDDEFINE

DEFINE CLASS frmfoxrefoptions AS cfoxrefform OF "foxctrls.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="cmdOK" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cmdCancel" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="pgfInfo" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="pgfInfo.Page1.txtFontString" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="pgfInfo.Page1.cmdFont" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="pgfInfo.Page1.opgBackupStyle" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="pgfInfo.Page1.lblBackupStyle" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="pgfInfo.Page1.cmdCleanup" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="pgfInfo.Page1.cmdGetFolder" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="pgfInfo.Page1.txtDirectory" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="pgfInfo.Page1.oOptionTree" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="pgfInfo.Page1.edtDescription" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="pgfInfo.Page1.lblDirectory" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*m: cleanuptables
		*m: savefoxrefoptions
		*m: updatecontrols
		*m: updatedescription
		*p: lchanged
		*p: ofoxref
		*p: ooptionscollection
	*</DefinedPropArrayMethod>

	*<PropValue>
		AlwaysOnTop = .T.
		AutoCenter = .T.
		Caption = "Options"
		cresourceid = FOXREF
		Desktop = .T.
		DoCreate = .T.
		Height = 416
		HelpContextID = 1231104
		MaxButton = .F.
		MinButton = .F.
		Name = "frmFoxRefOptions"
		ofoxref = .NULL.
		ooptionscollection = .NULL.
		Width = 457
		WindowType = 1
	*</PropValue>

	ADD OBJECT 'cmdCancel' AS cfoxbutton WITH ;
		Cancel = .T., ;
		Caption = "Cancel", ;
		Left = 374, ;
		Name = "cmdCancel", ;
		TabIndex = 3, ;
		Top = 385
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'cmdOK' AS cfoxbutton WITH ;
		Default = .T., ;
		Left = 294, ;
		Name = "cmdOK", ;
		TabIndex = 2, ;
		Top = 385
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'pgfInfo' AS pageframe WITH ;
		BorderWidth = 0, ;
		ErasePage = .T., ;
		Height = 379, ;
		Left = 2, ;
		Name = "pgfInfo", ;
		PageCount = 2, ;
		SpecialEffect = 2, ;
		TabIndex = 1, ;
		Tabs = .F., ;
		TabStyle = 1, ;
		Themes = .F., ;
		Top = 3, ;
		Width = 452, ;
		Page1.Caption = "Options", ;
		Page1.FontName = "Tahoma", ;
		Page1.FontSize = 8, ;
		Page1.Name = "Page1", ;
		Page2.Caption = "Add-Ins", ;
		Page2.FontName = "Tahoma", ;
		Page2.FontSize = 8, ;
		Page2.Name = "Page2"
		*< END OBJECT: BaseClass="pageframe" />

	ADD OBJECT 'pgfInfo.Page1.cmdCleanup' AS cfoxbutton WITH ;
		AutoSize = .T., ;
		Caption = "\<Clean Up Source Tables", ;
		Height = 23, ;
		Left = 8, ;
		Name = "cmdCleanup", ;
		TabIndex = 10, ;
		Top = 350, ;
		Width = 129
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'pgfInfo.Page1.cmdFont' AS cfoxbutton WITH ;
		Caption = "\<Font...", ;
		Height = 23, ;
		Left = 388, ;
		Name = "cmdFont", ;
		TabIndex = 6, ;
		Top = 268, ;
		Width = 58
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'pgfInfo.Page1.cmdGetFolder' AS cfoxbutton WITH ;
		Caption = "...", ;
		Height = 21, ;
		Left = 424, ;
		Name = "cmdGetFolder", ;
		TabIndex = 9, ;
		Top = 323, ;
		Width = 22, ;
		ZOrderSet = 5
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'pgfInfo.Page1.edtDescription' AS cfoxeditbox WITH ;
		Height = 60, ;
		IntegralHeight = .T., ;
		Left = 6, ;
		Name = "edtDescription", ;
		ReadOnly = .T., ;
		ScrollBars = 0, ;
		TabIndex = 2, ;
		TabStop = .F., ;
		Top = 150, ;
		Width = 440
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="editbox" />

	ADD OBJECT 'pgfInfo.Page1.lblBackupStyle' AS cfoxlabel WITH ;
		Alignment = 2, ;
		BackStyle = 1, ;
		Caption = "Backup style", ;
		Height = 15, ;
		Left = 17, ;
		Name = "lblBackupStyle", ;
		Style = 3, ;
		TabIndex = 3, ;
		Top = 216, ;
		Width = 63
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="label" />

	ADD OBJECT 'pgfInfo.Page1.lblDirectory' AS cfoxlabel WITH ;
		Caption = "Folder for code references tables:", ;
		Height = 15, ;
		Left = 12, ;
		Name = "lblDirectory", ;
		TabIndex = 7, ;
		Top = 309, ;
		Width = 287
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="label" />

	ADD OBJECT 'pgfInfo.Page1.oOptionTree' AS olecontrol WITH ;
		Height = 137, ;
		Left = 6, ;
		Name = "oOptionTree", ;
		TabIndex = 1, ;
		Top = 8, ;
		Width = 440
		*< END OBJECT: BaseClass="olecontrol" OLEObject="c:\winnt\system32\mscomctl.ocx" Value="0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7///8EAAAA/v///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADBcUXv6NsQBAwAAAIACAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAiwAAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAABcAAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAACMBAAAAAAAABAAAAAIAAAD+////BQAAAAkAAAAGAAAABwAAAAgAAAD+/////v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+2kEHHiYXREbFqAMDwKDYoIUM0EggAAAB6LQAAKQ4AALE8wWoBAAYAIgAAADwAAAAJAQAADQAAAEHmGgAB782rXAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAACQAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA5MzY4MjY1RS04NUZFLTExZDEtOEJFMy0wMDAwRjg3NTREQTEAAAAAyr8AAAAAAABEwAAAAAAAAAzBAAAAAAAA2MEAAAAAAAABAACADgAAAEhpZGVTZWxlY3Rpb24ABQAAAEwAAAAADAAAAEluZGVudGF0aW9uABEAAABODQAAAAcAAAAAAAAAAAAFABDoGgAGAAAAAAAAAAUAAIBI5xIAAQAAAFwAH97svQEABQBR5xIAA1LjC5GPzhGd4wCqAEu4UQEAAACQAQAAJEAKAAAATGFiZWxFZGl0AAkAAABJCgAAAAEAAAAKAAAATGluZVN0eWxlAAkAAABJCgAAAAAAAAANAAAATW91c2VQb2ludGVyAAkAAABJCgAAAAAAAAAOAAAAUGF0aFNlcGFyYXRvcgAKAAAASAAAAAABAAAAXAwAAABPTEVEcmFnTW9kZQAJAAAASQoAAAAAAAAADAAAAE9MRURyb3BNb2RlAAkAAABJCgAAAAAAAAALAAAAQ2hlY2tib3hlcwAFAAAATAEAAAAMAAAASG90VHJhY2tpbmcABQAAAEwBAAAAAGUAbgBnAGkAbgBlAC4AZABsAGwAAABBAGQAYQBEQgEABlRhaG9tYQBhAHMAeQBDAEQARQBuAGcAaQBuAGUAIABDAGwAYQBzAHMACQB7ADMANgA2ADMAMwAxADEAQgAtADYAQwBBAEMALQAxADEARAAxAC0AOQAyADkANgAtADQANAA0ADUANQAzADUANAAwADAAMAAwAH0AIABDADoAXABQAHIAbwBnAHIAYQBtACAARgBpAGwAZQBzAFwAQQBkAGEAcAB0AGUAYwBcAFMAaABhAHIAZQBkAFwARQBDAEQAQwAgAEUAbgBnAGkAbgBlAFwAZQBuAGcAaQBuAGUALgBkAGwAbAAAAEEAZABhAHAAdABlAGMAIABDAEQAIABHAHUAaQBkAGUACQB7AEIANgA3ADIAMgBCAEEAQgAtADIAQQBEADIALQAxADEARAAyAC0AOQBEADYAMwAtADAAMAA0ADAARAAwADAAMABCAEQAOQBEAH0AIABDADoAXABQAFIATwBHAFIAQQB+ADEAXABBAGQAYQBwAHQAZQBjAFwAUwBoAGEAcgBlAGQAXABDAEQARwB1AGkAZABlAFwAQwBEAEcAdQBpAGQAZQAuAG8AYwB4AAAAYQBkAGIA" />

	ADD OBJECT 'pgfInfo.Page1.opgBackupStyle' AS cfoxoptiongroup WITH ;
		Height = 37, ;
		Left = 6, ;
		Name = "opgBackupStyle", ;
		TabIndex = 4, ;
		Top = 222, ;
		Width = 440, ;
		Option1.Caption = "Filename.ext.bak", ;
		Option1.Height = 17, ;
		Option1.Left = 7, ;
		Option1.Name = "Option1", ;
		Option1.Top = 11, ;
		Option1.Width = 146, ;
		Option2.Caption = "Backup of Filename.ext", ;
		Option2.Height = 17, ;
		Option2.Left = 161, ;
		Option2.Name = "Option2", ;
		Option2.Top = 11, ;
		Option2.Width = 169
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="optiongroup" />

	ADD OBJECT 'pgfInfo.Page1.txtDirectory' AS cfoxtextbox WITH ;
		Height = 21, ;
		Left = 9, ;
		MaxLength = 255, ;
		Name = "txtDirectory", ;
		TabIndex = 8, ;
		Top = 323, ;
		Width = 412, ;
		ZOrderSet = 6
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="textbox" />

	ADD OBJECT 'pgfInfo.Page1.txtFontString' AS cfoxtextbox WITH ;
		Height = 21, ;
		Left = 8, ;
		Name = "txtFontString", ;
		ReadOnly = .T., ;
		TabIndex = 5, ;
		TabStop = .F., ;
		Top = 269, ;
		Width = 376
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="textbox" />
	
	PROCEDURE cleanuptables
		#include "foxpro.h"
		LOCAL nMouse
		
		IF VARTYPE(THIS.oFoxRef) == 'O'
			m.nMouse = THISFORM.MousePointer
			THISFORM.MousePointer = MOUSE_HOURGLASS
		
			IF THIS.oFoxRef.CleanupTables()
				THIS.pgfInfo.Page1.cmdCleanup.Enabled = .F.
			ENDIF
		
			THISFORM.MousePointer = m.nMouse
		ENDIF
		
	ENDPROC

	PROCEDURE Init
		#include "foxref.h"
		LPARAMETERS oFoxRef, lFromSearchDialog
		LOCAL oRefOption
		LOCAL oNode
		LOCAL i
		LOCAL nOffset
		
		DODEFAULT()
		
		THIS.BorderStyle = 2  && fixed dialog
		
		IF VARTYPE(oFoxRef) <> 'O'
			oFoxRef = NEWOBJECT("FoxRef", "foxrefengine.prg", .NULL., .T.)
			oFoxRef.RestorePrefs()
		ENDIF
		
		IF VARTYPE(oFoxRef) == 'O'
			THIS.oFoxRef = oFoxRef
		
			WITH THIS.pgfInfo.Page1
				.opgBackupStyle.Value = oFoxRef.BackupStyle
				.txtFontString.Value  = oFoxRef.FontString
				.txtDirectory.Value   = oFoxRef.FoxRefDirectory
			ENDWITH
		
			WITH THIS.pgfInfo.Page1.oOptionTree
				.Nodes.Clear()
		
				THIS.oOptionsCollection = oFoxRef.GetAvailableOptions()
				IF VARTYPE(THIS.oOptionsCollection) == 'O'
					FOR i = 1 TO THIS.oOptionsCollection.Count
						oRefOption = THIS.oOptionsCollection.Item(m.i)
						oNode = .Nodes.Add(,,THIS.oOptionsCollection.GetKey(m.i), oRefOption.OptionName)
						oNode.Checked = NVL(oRefOption.OptionValue, .F.)
					ENDFOR
				ENDIF
			ENDWITH
		ELSE
			THIS.pgfInfo.Page1.txtFontString.Value = FONT_DEFAULT
		ENDIF
		
		* if this is being called from the Search Dialog, then don't
		* display BackupStyle or Font
		IF lFromSearchDialog
			WITH THIS.pgfInfo.Page1
				nOffset = THIS.pgfInfo.Height - (.edtDescription.Top + .edtDescription.Height) - 10
				.lblBackupStyle.Visible = .F.
				.opgBackupStyle.Visible = .F.
				.txtFontString.Visible  = .F.
				.cmdFont.Visible        = .F.
				.lblDirectory.Visible   = .F.
				.txtDirectory.Visible   = .F.
				.cmdCleanup.Visible     = .F.
			ENDWITH
			THIS.pgfInfo.Height = THIS.pgfInfo.Height - nOffset
			THIS.Height = THIS.Height - nOffset
			THIS.cmdOK.Top = THIS.cmdOK.Top - nOffset
			THIS.cmdCancel.Top = THIS.cmdCancel.Top - nOffset
			THIS.AutoCenter = .T.
		ENDIF
		
		THIS.UpdateDescription()
		
		THIS.UpdateControls()
		
	ENDPROC

	PROCEDURE savefoxrefoptions
		* -- Save the options (goes to FoxUser)
		#include "foxpro.h"
		#include "foxref.h"
		
		LOCAL i
		LOCAL oNode
		LOCAL oRefOption
		
		IF VARTYPE(THIS.oFoxRef) == 'O'
			IF EMPTY(THIS.pgfInfo.Page1.txtDirectory.Value) OR !DIRECTORY(THIS.pgfInfo.Page1.txtDirectory.Value)
				IF MESSAGEBOX(FOXREFDIRECTORY_NOEXIST_LOC, MB_ICONQUESTION + MB_YESNO + MB_DEFBUTTON2, THIS.Caption) == IDNO
					THIS.pgfInfo.Page1.txtDirectory.SetFocus()
					RETURN .F.
				ENDIF
			ENDIF
		
			THIS.oFoxRef.BackupStyle     = THIS.pgfInfo.Page1.opgBackupStyle.Value
			THIS.oFoxRef.FontString      = THIS.pgfInfo.Page1.txtFontString.Value
			THIS.oFoxRef.FoxRefDirectory = ADDBS(THIS.pgfInfo.Page1.txtDirectory.Value)
		
			WITH THIS.pgfInfo.Page1.oOptionTree
				IF VARTYPE(THIS.oOptionsCollection) == 'O'
					FOR EACH oNode IN .Nodes
						oRefOption = THIS.oOptionsCollection.Item(oNode.Key)
						oRefOption.OptionValue = oNode.Checked
					ENDFOR
				ENDIF
			ENDWITH
			THIS.oFoxRef.SaveOptions(THIS.oOptionsCollection)
			THIS.oFoxRef.SavePrefs()
		ENDIF
		
	ENDPROC

	PROCEDURE updatecontrols
	ENDPROC

	PROCEDURE updatedescription
		* update the description textbox when the node changes
		LPARAMETERS oNode
		LOCAL oRefOption
		
		IF VARTYPE(oNode) <> 'O'
			oNode = THIS.pgfInfo.Page1.oOptionTree.Nodes(1)
		ENDIF
		
		TRY
			oRefOption = THIS.oOptionsCollection.Item(oNode.Key)
		CATCH
			oRefOption = .NULL.
		ENDTRY
		
		IF ISNULL(oRefOption)
			THIS.pgfInfo.Page1.edtDescription.Value = ''
		ELSE
			THIS.pgfInfo.Page1.edtDescription.Value = oRefOption.Description
		ENDIF
		
		
	ENDPROC

	PROCEDURE cmdCancel.Click
		THISFORM.Release()
		
	ENDPROC

	PROCEDURE cmdOK.Click
		IF THIS.Parent.SaveFoxRefOptions()
			THISFORM.Release()
		ENDIF
		
	ENDPROC

	PROCEDURE pgfInfo.Page1.cmdCleanup.Click
		#include "foxpro.h"
		#include "foxref.h"
		
		IF MessageBox(CLEANUP_CONFIRM_LOC, MB_ICONQUESTION + MB_YESNO, APPNAME_LOC) == IDYES
			THISFORM.CleanupTables()
		ENDIF
		
		
	ENDPROC

	PROCEDURE pgfInfo.Page1.cmdFont.Click
		LOCAL cFontString, cNewFont
		LOCAL cFontFace, nFontSize, cFontStyle
		
		cFontString = THIS.Parent.txtFontString.Value
		
		cFontFace  = LEFT(cFontString, AT(",", cFontString) - 1)
		nFontSize  = SUBSTR(cFontString, AT(",", cFontString) + 1)
		nFontSize  = VAL(LEFT(nFontSize, AT(",", nFontSize) - 1))
		cFontStyle = SUBSTR(cFontString, AT("," ,cFontString,2) + 1)
		
		cNewFont = GETFONT(cFontFace, nFontSize, cFontStyle)
		IF !EMPTY(cNewFont)
			THIS.Parent.txtFontString.Value = cNewFont
		ENDIF
		
	ENDPROC

	PROCEDURE pgfInfo.Page1.cmdGetFolder.Click
		LOCAL cDirectory
		LOCAL cExt
		
		m.cDirectory = GETDIR(THIS.Parent.txtDirectory.Value, '', '', 64 + 1)
		IF !EMPTY(m.cDirectory)
			THIS.Parent.txtDirectory.Value = m.cDirectory
		ENDIF
		
	ENDPROC

	PROCEDURE pgfInfo.Page1.oOptionTree.KeyDown
		*** ActiveX Control Event ***
		LPARAMETERS keycode, shift
		
		IF KeyCode == 112  && F1
			TRY
				HELP ID (THISFORM.HelpContextID)
			CATCH
			ENDTRY
		ENDIF
		
	ENDPROC

	PROCEDURE pgfInfo.Page1.oOptionTree.KeyPress
		*** ActiveX Control Event ***
		LPARAMETERS keyascii
		
		DO CASE
		CASE keyascii == 27  && escape
			THISFORM.Release()
		ENDCASE
		
	ENDPROC

	PROCEDURE pgfInfo.Page1.oOptionTree.NodeCheck
		*** ActiveX Control Event ***
		LPARAMETERS oNode
		
		THISFORM.lChanged=.T.
		
	ENDPROC

	PROCEDURE pgfInfo.Page1.oOptionTree.NodeClick
		*** ActiveX Control Event ***
		LPARAMETERS oNode
		
		THISFORM.UpdateDescription(oNode)
		
	ENDPROC

ENDDEFINE
