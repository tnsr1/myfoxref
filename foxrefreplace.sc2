*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.21" SourceFile="foxrefreplace.scx" CPID="1252" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="1" />

	*<PropValue>
		DataSource = .NULL.
		Height = 0
		Left = 0
		Name = "Dataenvironment"
		Top = 0
		Width = 0
	*</PropValue>

ENDDEFINE

DEFINE CLASS frmfoxrefreplace AS cfoxrefform OF "foxctrls.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="shpOptions" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cmdClose" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtReplace" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cmdReplace" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cmdCancel" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblReplaceWith" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblReplacementErrors" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkBackupOnReplace" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkConfirmReplace" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="oBrowser" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblOptions" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkPreserveCase" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*m: doreplace
		*p: lsuccess
		*p: oerrorlist
		*p: ofoxref
	*</DefinedPropArrayMethod>

	*<PropValue>
		AlwaysOnTop = .T.
		AutoCenter = .T.
		Caption = "Replace"
		Desktop = .T.
		DoCreate = .T.
		Height = 249
		lsuccess = .F.
		MaxButton = .F.
		MinButton = .F.
		Name = "frmFoxRefReplace"
		ofoxref = .NULL.
		Width = 411
		WindowType = 1
	*</PropValue>

	ADD OBJECT 'chkBackupOnReplace' AS cfoxcheckbox WITH ;
		Caption = "Create \<backup of modified files", ;
		Height = 17, ;
		Left = 96, ;
		Name = "chkBackupOnReplace", ;
		TabIndex = 5, ;
		Top = 85, ;
		Width = 207, ;
		ZOrderSet = 7
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="checkbox" />

	ADD OBJECT 'chkConfirmReplace' AS cfoxcheckbox WITH ;
		Caption = "C\<onfirm replacements", ;
		Height = 17, ;
		Left = 96, ;
		Name = "chkConfirmReplace", ;
		TabIndex = 3, ;
		Top = 51, ;
		Value = .T., ;
		Width = 207, ;
		ZOrderSet = 8
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="checkbox" />

	ADD OBJECT 'chkPreserveCase' AS cfoxcheckbox WITH ;
		Caption = "\<Preserve case", ;
		Height = 17, ;
		Left = 96, ;
		Name = "chkPreserveCase", ;
		TabIndex = 4, ;
		Top = 68, ;
		Value = .T., ;
		Width = 207, ;
		ZOrderSet = 11
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="checkbox" />

	ADD OBJECT 'cmdCancel' AS cfoxbutton WITH ;
		Cancel = .T., ;
		Caption = "Cancel", ;
		Left = 334, ;
		Name = "cmdCancel", ;
		TabIndex = 8, ;
		Top = 34, ;
		ZOrderSet = 4
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'cmdClose' AS cfoxbutton WITH ;
		Cancel = .T., ;
		Caption = "Close", ;
		Left = 334, ;
		Name = "cmdClose", ;
		TabIndex = 11, ;
		Top = 34, ;
		Visible = .F., ;
		ZOrderSet = 1
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'cmdReplace' AS cfoxbutton WITH ;
		Caption = "\<Replace", ;
		Left = 334, ;
		Name = "cmdReplace", ;
		TabIndex = 7, ;
		Top = 7, ;
		ZOrderSet = 3
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'lblOptions' AS cfoxlabel WITH ;
		Alignment = 2, ;
		BackStyle = 1, ;
		Caption = "Options", ;
		Height = 15, ;
		Left = 97, ;
		Name = "lblOptions", ;
		Style = 3, ;
		TabIndex = 15, ;
		Top = 34, ;
		Width = 40, ;
		ZOrderSet = 10
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="label" />

	ADD OBJECT 'lblReplacementErrors' AS cfoxlabel WITH ;
		Caption = "Replacement Errors:", ;
		Height = 15, ;
		Left = 6, ;
		Name = "lblReplacementErrors", ;
		TabIndex = 9, ;
		Top = 113, ;
		Visible = .F., ;
		Width = 168, ;
		ZOrderSet = 6
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="label" />

	ADD OBJECT 'lblReplaceWith' AS cfoxlabel WITH ;
		Caption = "Replace \<with:", ;
		Height = 15, ;
		Left = 6, ;
		Name = "lblReplaceWith", ;
		TabIndex = 1, ;
		Top = 12, ;
		Width = 75, ;
		ZOrderSet = 5
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="label" />

	ADD OBJECT 'oBrowser' AS cwebbrowser WITH ;
		Height = 118, ;
		Left = 4, ;
		Name = "oBrowser", ;
		TabIndex = 10, ;
		Top = 127, ;
		Visible = .F., ;
		Width = 402, ;
		ZOrderSet = 9
		*< END OBJECT: ClassLib="foxref.vcx" BaseClass="olecontrol" OLEObject="c:\winnt\system32\shdocvw.dll" Value="0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFD25joZiMIBAwAAAEABAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArAAAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAA4AAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAQAAAAAAAAAAwAAAP7////+////BAAAAP7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9h+VaICjTQEalrAMBP1wWiTAAAAIwpAAAyDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAOAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAABkAGQAZQBkAAEAAIBvAG8AbABzAFwARQBWAEIAXABkAGUAdgBjAHQAcgBsAHMAXABtAHMAYwBlAHQAYQBiAHMAdAByAGkAcAABAAAA4NBXAHM1zxGuaQgAKy4SYggAAAAAAAAATAAAAAEUAgAAAAAAwAAAAAAAAEaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAA5ADkAMAAwADAAQwB9ACAARQA6AFwAVwBJAE4ATgBUAFwAUwB5AHMAdABlAG0AMwAyAFwAQwBGAEYASQBMAEUAfgAxAC4ARABMAEwAAABDAEYAUwBvAHUAcgBjAGUAQwBvAG4AdAByAG8AbAAgAEMAbwBuAHQAcgBvAGwACQB7ADEAMgA4ADgAMwA0AEEAMQAtADIANgA0ADYALQAxADEARAAxAC0AOQA0ADkAOQAtADAAMABBADAAMgA0ADcAOAAzADUARAA3AH0AIABFADoAXABXAA==" />

	ADD OBJECT 'shpOptions' AS shape WITH ;
		BackStyle = 0, ;
		Height = 68, ;
		Left = 87, ;
		Name = "shpOptions", ;
		SpecialEffect = 0, ;
		Style = 3, ;
		Top = 40, ;
		Width = 236, ;
		ZOrderSet = 0
		*< END OBJECT: BaseClass="shape" />

	ADD OBJECT 'txtReplace' AS cfoxtextbox WITH ;
		Format = "K", ;
		Left = 87, ;
		MaxLength = 255, ;
		Name = "txtReplace", ;
		TabIndex = 2, ;
		Top = 8, ;
		Width = 235, ;
		ZOrderSet = 2
		*< END OBJECT: ClassLib="foxctrls.vcx" BaseClass="textbox" />
	
	PROCEDURE doreplace
		* Abstract:
		*   Perform the replacement.
		*
		* Parameters:
		*	None
		#include "foxref.h"
		LOCAL cReplaceText
		LOCAL i
		LOCAL oError
		
		m.cReplaceText = RTRIM(THIS.txtReplace.Value)
		
		THIS.cmdReplace.Enabled = .F.
		THIS.txtReplace.Enabled = .F.
		THIS.chkConfirmReplace.Enabled    = .F.
		THIS.chkPreserveCase.Enabled      = .F.
		THIS.chkBackupOnReplace.Enabled   = .F.
		
		THIS.oFoxRef.ConfirmReplace    = THIS.chkConfirmReplace.Value
		THIS.oFoxRef.PreserveCase      = THIS.chkPreserveCase.Value
		THIS.oFoxRef.BackupOnReplace   = THIS.chkBackupOnReplace.Value
		
		THIS.lSuccess = THIS.oFoxRef.GlobalReplace(m.cReplaceText)
		IF THIS.oFoxRef.Errors.Count > 0
			THIS.oBrowser.nBackColor = THIS.BackColor
		
			* fill the browser control with the errors
			cHTML = ''
			FOR m.i = 1 TO THIS.oFoxRef.Errors.Count
				cHTML = cHTML + "<div nowrap>" + THIS.oFoxRef.Errors.Item(m.i) + "</div>"
			ENDFOR
			THIS.oBrowser.Write(cHTML)
			
			THIS.oBrowser.Visible = .T.
			THIS.lblReplacementErrors.Visible = .T.
			THIS.Height = THIS.oBrowser.Top + THIS.oBrowser.Height + 3
			THIS.cmdCancel.Visible = .F.
			THIS.cmdClose.Visible  = .T.
		ELSE
			THIS.Release()
		ENDIF
		
		
	ENDPROC

	PROCEDURE Init
		#include "foxref.h"
		* Parameters:
		*	<oFoxRef>
		LPARAMETERS oFoxRef
		
		SET TALK OFF
		
		DODEFAULT()
		
		THIS.BorderStyle = 2  && fixed dialog
		THIS.lSuccess = .F.
		
		IF VARTYPE(oFoxRef) == 'O'
			THIS.oFoxRef = oFoxRef
			THIS.chkConfirmReplace.Value    = THIS.oFoxRef.ConfirmReplace
			THIS.chkPreserveCase.Value      = THIS.oFoxRef.PreserveCase
			THIS.chkBackupOnReplace.Value   = THIS.oFoxRef.BackupOnReplace
		ENDIF
		
		THIS.oErrorList = NEWOBJECT("CFoxRefCollection", "FoxRefCollection.prg")
		
		THIS.txtReplace.Value = ''
		THIS.Height = THIS.shpOptions.Top + THIS.shpOptions.Height + 5
		
	ENDPROC

	PROCEDURE Unload
		RETURN THIS.lSuccess
		
	ENDPROC

	PROCEDURE cmdCancel.Click
		THISFORM.Release()
		
	ENDPROC

	PROCEDURE cmdClose.Click
		THISFORM.Release()
		
	ENDPROC

	PROCEDURE cmdReplace.Click
		THISFORM.DoReplace()
		
	ENDPROC

ENDDEFINE
